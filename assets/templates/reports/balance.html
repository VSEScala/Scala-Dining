{% extends 'reports/base.html' %}

{% block report %}
    <h2>
        Balance report
        <small class="text-muted">{{ year }}</small>
    </h2>

    <div class="mb-3">
        <a href="{% url 'reports:balance' %}?year={{ year|add:'-1' }}"
           class="btn btn-secondary btn-sm">
            <i class="fas fa-chevron-left"></i>
            Previous year
        </a>
        <a href="{% url 'reports:balance' %}?year={{ year|add:'1' }}"
           class="btn btn-secondary btn-sm">
            <i class="fas fa-chevron-right"></i>
            Next year
        </a>
    </div>

    <p class="lead">
        Bookkeeping accounts are shown in <span class="bg-primary p-1 rounded">blue</span>.
        Association accounts are <span class="bg-secondary p-1 rounded">gray</span>.
        All individual user balances are summed together and shown as
        <span class="bg-dark p-1 rounded">a single row</span> at the bottom.
        Accounts for which no transactions took place are omitted.
    </p>


    {% for period, bookkeeping, association, user_pile in report_display %}
        <h4>{{ period.get_display_name }}</h4>

        <table class="table table-sm">
            <thead>
            <tr>
                <th scope="col">Account</th>
                <th scope="col" class="text-right">Start balance</th>
                <th scope="col" class="text-right">Increase</th>
                <th scope="col" class="text-right">Reduction</th>
                <th scope="col" class="text-right">End balance</th>
            </tr>
            </thead>
            <tbody>
            {% for account, statement in bookkeeping %}
                <tr class="table-primary">
                    <td>{{ account.get_special_display }}</td>
                    <td class="text-right">{{ statement.start_balance }}</td>
                    <td class="text-right">{{ statement.increase|default:"–" }}</td>
                    <td class="text-right">{{ statement.reduction|default:"–" }}</td>
                    <td class="text-right">{{ statement.end_balance }}</td>

                </tr>
            {% endfor %}
            {% for account, statement in association %}
                <tr class="table-secondary">
                    <td>{{ account.association.name }}</td>
                    <td class="text-right">{{ statement.start_balance }}</td>
                    <td class="text-right">{{ statement.increase|default:"–" }}</td>
                    <td class="text-right">{{ statement.reduction|default:"–" }}</td>
                    <td class="text-right">{{ statement.end_balance }}</td>
                </tr>
            {% endfor %}
            {% if user_pile %}
                <tr class="table-dark">
                    <td>User accounts</td>
                    <td class="text-right">{{ user_pile.start_balance }}</td>
                    <td class="text-right">{{ user_pile.increase|default:"–" }}</td>
                    <td class="text-right">{{ user_pile.reduction|default:"–" }}</td>
                    <td class="text-right">{{ user_pile.end_balance }}</td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    {% endfor %}

{% endblock %}
